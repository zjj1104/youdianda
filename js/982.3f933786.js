"use strict";(self["webpackChunkyoudianda_demo"]=self["webpackChunkyoudianda_demo"]||[]).push([[982],{3982:function(t,a,e){e.r(a),e.d(a,{default:function(){return f}});var s=function(){var t=this,a=t._self._c;return a("div",[a("van-nav-bar",{attrs:{title:"发布"}}),a("van-form",{on:{submit:t.onSubmit}},[a("van-field",{attrs:{name:"title",label:"文章标题",placeholder:"请输入文章内容",rules:[{required:!0,message:"请填写文章标题"}]},model:{value:t.user1.title,callback:function(a){t.$set(t.user1,"title",a)},expression:"user1.title"}}),a("van-field",{attrs:{readonly:"",clickable:"",name:"cateid",value:t.value,label:"文章分类",placeholder:"请选择文章分类",rules:[{required:!0,message:"请选择文章分类"}]},on:{click:function(a){t.showCate=!0}}}),a("van-popup",{attrs:{position:"bottom"},model:{value:t.showCate,callback:function(a){t.showCate=a},expression:"showCate"}},[a("van-picker",{attrs:{"show-toolbar":"",columns:t.allCate},on:{confirm:t.confirm,cancel:function(a){t.showCate=!1}}})],1),a("van-field",{attrs:{readonly:"",clickable:"",name:"tags",value:t.user1.tags,label:"文章标签",placeholder:"请选择文章标签",rules:[{required:!0,message:"请选择文章标签"}]},on:{click:function(a){t.showTags=!0}}}),a("van-popup",{attrs:{position:"bottom"},model:{value:t.showTags,callback:function(a){t.showTags=a},expression:"showTags"}},[a("van-picker",{attrs:{"show-toolbar":"",columns:t.tags},on:{confirm:t.confirmTag,cancel:function(a){t.showTags=!1}}})],1),a("div",{staticClass:"file"},[a("span",{staticClass:"text"},[t._v("文件上传")]),a("van-uploader",{attrs:{"after-read":t.afterRead,multiple:""},model:{value:t.fileList,callback:function(a){t.fileList=a},expression:"fileList"}})],1),a("van-field",{attrs:{name:"content",label:"文章正文",placeholder:"文章正文",rules:[{required:!0,message:"请填写文章内容"}]},model:{value:t.user1.content,callback:function(a){t.$set(t.user1,"content",a)},expression:"user1.content"}}),a("div",{staticClass:"btn_box",staticStyle:{margin:"16px"}},[a("van-button",{attrs:{icon:"plus",type:"primary","ative-type":"submit"},on:{click:function(a){t.user1.status="2"}}},[t._v("提交")]),a("van-button",{attrs:{icon:"send-gift-o",type:"info"},on:{click:function(a){t.user1.status="1"}}},[t._v("存草稿")]),a("van-button",{attrs:{icon:"replay",type:"danger","native-type":"reset"}},[t._v("重置")])],1)],1)],1)},o=[],i=e(3822),n=e(4471);const l=t=>(0,n.Z)({url:"/index/index",params:t}),r=t=>(0,n.Z)({url:"/common/upload/?type=images",method:"POST",headers:{"Content-Type":"multipart/form-data"},data:t}),c=t=>(0,n.Z)({url:"/user/addArticle",method:"POST",data:t});var u={data(){return{user1:{title:"",tags:"",pic:"",content:"",status:"2",cateid:0,author:localStorage.getItem("author")||""},value:"",showTags:!1,showCate:!1,tags:[],allCate:[],cateid:[],fileList:[]}},computed:{...(0,i.rn)(["user"])},created(){this.getInfo()},methods:{confirmTag(t){this.user1.tags=t,this.showTags=!1},confirm(t){this.value=t,this.showCate=!1},async getInfo(){const{data:t}=await l(),a=[];console.log(t);const e=t.data.allCate;this.author=this.Author,e.forEach((t=>a.push(t.catename))),this.allCate=a,this.cateid=e;const s=[],o=t.data.allTag;o.forEach((t=>s.push(t.tagname))),this.tags=s},async afterRead(t){this.$toast.loading({message:"上传中...",forbidClick:!0,duration:0});const a=await r({file:t.file});this.$toast.success("上传图片成功"),this.user1.pic=a.data.data.savePath},async onSubmit(){const t=this.cateid.findIndex((t=>t.catename===this.value)),a=this.cateid[t].id;this.user1.cateid=a;const{data:e}=await c(this.user1);""===e.errmsg&&this.user1?(this.$toast.success("发布成功"),this.$router.push("/myarticle")):this.$toast.fail("发布失败,请检查是否登录")}}},d=u,h=e(1001),m=(0,h.Z)(d,s,o,!1,null,null,null),f=m.exports}}]);